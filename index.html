<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <title>Gráficos Interactivos</title>
    <script src="https://cdn.plot.ly/plotly-latest.min.js"></script>
</head>
<body>
    <h1>Gráficos Interactivos (Plotly.js)</h1>
    <div id="torta" style="width: 45%; display: inline-block;"></div>
    <div id="barras" style="width: 45%; display: inline-block;"></div>

    <script>
        // Datos simulados
        const data = [
            {{ categoria: "A", subgrupo: "X", valor: 10 }},
            {{ categoria: "A", subgrupo: "Y", valor: 20 }},
            {{ categoria: "B", subgrupo: "X", valor: 30 }},
            {{ categoria: "B", subgrupo: "Y", valor: 10 }},
            {{ categoria: "C", subgrupo: "X", valor: 15 }},
            {{ categoria: "C", subgrupo: "Y", valor: 25 }},
        ];

        // Sumar por categoría para el gráfico de torta
        function getSumaPorCategoria() {
            const resumen = {};
            data.forEach(d => {
                if (!resumen[d.categoria]) resumen[d.categoria] = 0;
                resumen[d.categoria] += d.valor;
            });
            return {
                labels: Object.keys(resumen),
                values: Object.values(resumen)
            };
        }

        // Filtrar por categoría para mostrar subgrupos
        function getDatosPorCategoria(categoria) {
            return data.filter(d => d.categoria === categoria);
        }

        // Gráfico de torta inicial
        const tortaDatos = getSumaPorCategoria();
        const torta = {
            labels: tortaDatos.labels,
            values: tortaDatos.values,
            type: 'pie'
        };

        Plotly.newPlot('torta', [torta], { title: 'Distribución por Categoría' });

        // Gráfico de barras vacío
        Plotly.newPlot('barras', [], { title: 'Subgrupos por Categoría Seleccionada' });

        // Evento de clic en gráfico de torta
        const tortaDiv = document.getElementById('torta');
        tortaDiv.on('plotly_click', function(dataClick) {
            const categoriaSeleccionada = dataClick.points[0].label;
            const filtrado = getDatosPorCategoria(categoriaSeleccionada);

            const barras = {
                x: filtrado.map(d => d.subgrupo),
                y: filtrado.map(d => d.valor),
                type: 'bar'
            };

            Plotly.react('barras', [barras], {
                title: 'Subgrupos de ' + categoriaSeleccionada
            });
        });
    </script>
</body>
</html>
